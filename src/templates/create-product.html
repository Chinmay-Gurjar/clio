{% extends "base.html" %}
<!-- 
    Copyright (C) 2018 Gopalakrishnan

    SPDX-License-Identifier: GPL-3.0-or-later
    See GPL-3.0-or-later in the Licenses folder for license information
-->

{% block content %}

<link href="/static/calendar.min.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/static/calendar.min.js"></script>

<script>
$(document).ready(function() {
    $('#approval_date').calendar({
	type: 'date', 
	maxDate: new Date()
    });
    $('.ui.dropdown').dropdown();
    $('.ui.form')
	.form({
	    fields: {
		name     : 'empty',
		version  : 'empty',
	    }
	})
    ;
    $(function() {
	$("body").on("click", ".ui.icon.button", function() {
	    var length = $(".input-group").length;
	    var clone = $("#selection").clone();
	    clone.find("select#component").attr("name", "component-"+length);
	    clone.find("select#relation").attr("name", "relation-"+length);
	    clone.find("select#delivery").attr("name", "delivery-"+length);
	    clone.find("input#modification").attr("name", "modification-"+length);
	    clone.find(".ui.dropdown").dropdown('clear');
	    clone.find(".ui.checkbox").checkbox('uncheck');
	    $("#selections").append(clone);
	});
    });
});
</script>

<style>
.ui.main.container {
    margin-top: 50px !important;
}
.ui.dividing.header {
    margin-top: 30px !important;
    margin-bottom: 30px !important;
}
.ui.icon.button {
    position: absolute;
    right: 0;
    bottom: 0;
}
.ui.primary.button {
    margin-bottom: 10px !important;
}
</style>
<div class="ui main container">
    {% with errors = get_flashed_messages(category_filter=['error']) %}
    {% if(errors) %}
    <div class="ui error message">
	<div class="header">
	    There where some errors with your submission
	</div>
	<ul>
	    {% for error in errors %}
	    <li> {{ error }} </li>
	    {% endfor %}
	</ul>
    </div>
    {% endif %}
    {% endwith %}
    {% with success_messages = get_flashed_messages(category_filter=['success']) %}
    {% if(success_messages) %}
    {% for success_message in success_messages %}
    <div class="ui success message">
	<div class="header">
	    {{ success_message }} 
	</div>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}
    <form class="ui equal width form" action={{ url_for("create_product") }} method="post">
	<h4 class="ui dividing header">Create Product</h4>
	<div class="fields">
	    <div class="required field">
		<label>Product Name</label>
		<input type="text" name="name" placeholder="Name">
	    </div>
	    <div class="required field">
		<label>Version</label>
		<input type="text" name="version" placeholder="Version">
	    </div>
	    <div class="field">
		<label>Owner</label>
		<input type="text" name="owner" placeholder="Owner">
	    </div>
	</div>
	<div class="fields">
	    <div class="field">
		<label>License</label>
		<select name="license" class="ui search selection dropdown">
		    <option value="">License</option>
		    {% for license in licenses %}
		    <option class="item" value="{{ license.full_name }}"> {{ license.full_name }} </option>
		    {% endfor %}
		</select>
	    </div>
	    <div class="field">
		<label>Approver</label>
		<input type="text" name="approver" placeholder="Approver">
	    </div>
	</div>
	<div class="fields ui calender" id="approval_date">
	    <div class="field">
		<label>Approval Date</label>
		<div class="ui input left icon">
		    <i class="calendar icon"></i>
		    <input type="text" name="approval_date" placeholder="Date">
		</div>
	    </div>
	</div>
	<div id="selections">
	<div class="input-group" id="selection">
	    <div class="fields">
		<div class="field">
		    <label>Component</label>
		    <select id="component" name="component-0" class="ui search selection dropdown">
			<option value="">Component</option>
			{% for component in components %}
			<option class="item" value="{{ component.name }}"> {{ component.name }} </option>
			{% endfor %}
		    </select>
		</div>
		<div class="field">
		    <label>Relation</label>
		    <select id="relation" name="relation-0" class="ui search selection dropdown">
			<option value="">Relation</option>
			{% for relation in relations %}
			<option class="item" value="{{ relation }}"> {{ relation }} </option>
			{% endfor %}
		    </select>
		</div>
		<div class="field">
		    <label>Delivery</label>
		    <select id="delivery" name="delivery-0" class="ui search selection dropdown">
			<option value="">Delivery</option>
			{% for delivery in valid_delivery %}
			<option class="item" value="{{ delivery }}"> {{ delivery }} </option>
			{% endfor %}
		    </select>
		</div>
	    </div>
	    <div class="ui grid">
		<div class="eight wide column">
		    <div class="grouped fields">
			<label>Modification</label>
			<div class="field">
			    <div class="ui radio checkbox">
				<input type="radio" id="modification" name="modification-0" value="true">
				<label>True</label>
			    </div>
			</div>
			<div class="field">
			    <div class="ui radio checkbox">
				<input type="radio" id="modification" name="modification-0" value="false">
				<label>False</label>
			    </div>
			</div>
		    </div>
		</div>
		<div class="eight wide column">
		    <div class="grouped fields">
			<div class="ui icon button">
			    <i class="edit icon"></i>
			</div>
		    </div>
		</div>
	    </div>
	    <br />
	</div>
	</div>
	<button class="ui primary button" type="submit">Save</button>
    </form>
    {% endblock %}
